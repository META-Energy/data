<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Franz Prante">

<title>Abstract screening report and full text download data preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="merging_testing_pre_download_files/libs/clipboard/clipboard.min.js"></script>
<script src="merging_testing_pre_download_files/libs/quarto-html/quarto.js"></script>
<script src="merging_testing_pre_download_files/libs/quarto-html/popper.min.js"></script>
<script src="merging_testing_pre_download_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="merging_testing_pre_download_files/libs/quarto-html/anchor.min.js"></script>
<link href="merging_testing_pre_download_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="merging_testing_pre_download_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="merging_testing_pre_download_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="merging_testing_pre_download_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="merging_testing_pre_download_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#tests" id="toc-tests" class="nav-link" data-scroll-target="#tests">Tests</a></li>
  <li><a href="#analyses-of-screening" id="toc-analyses-of-screening" class="nav-link" data-scroll-target="#analyses-of-screening">Analyses of screening</a></li>
  </ul></li>
  <li><a href="#code-and-output-for-testing-merging-analyzing-and-preparing-full-text-download-of-abstract-screening-dataset" id="toc-code-and-output-for-testing-merging-analyzing-and-preparing-full-text-download-of-abstract-screening-dataset" class="nav-link" data-scroll-target="#code-and-output-for-testing-merging-analyzing-and-preparing-full-text-download-of-abstract-screening-dataset">Code and output for testing, merging, analyzing and preparing full text download of abstract screening dataset</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Abstract screening report and full text download data preparation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Franz Prante </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>(All based on code below)</p>
<section id="tests" class="level3">
<h3 class="anchored" data-anchor-id="tests">Tests</h3>
<section id="valid-screener-notes" class="level4">
<h4 class="anchored" data-anchor-id="valid-screener-notes">Valid screener notes?</h4>
<ul>
<li>Screener 1 notes are valid.</li>
<li>For screener 2, there is one “91”, which is supposed to be “01”. But the exclusion of the study is valid.</li>
</ul>
</section>
<section id="do-screener-notes-correctly-correspond-to-in-exclusion-of-studies" class="level4">
<h4 class="anchored" data-anchor-id="do-screener-notes-correctly-correspond-to-in-exclusion-of-studies">Do screener notes correctly correspond to in-/exclusion of studies?</h4>
<section id="screener-1" class="level5">
<h5 class="anchored" data-anchor-id="screener-1">Screener 1</h5>
<ul>
<li>For screener 1, no entry that carries an inclusion note is excluded. This is valid.</li>
<li>For screener 1, there is one entry that is included though it carries an exclusion note. But no correction necessary, as the entry will be excluded in the full text screening phase.</li>
</ul>
</section>
<section id="screener-2" class="level5">
<h5 class="anchored" data-anchor-id="screener-2">Screener 2</h5>
<ul>
<li>For screener 2, there is one entry that was excluded though it carries an inclusion note. Correction not necessary because this single mistake will only marginally affect the sample.</li>
<li>For screener 2, there are two entries which were included though they carry exclusion notes. But no correction necessary, as these entries will be excluded in the full text screening phase.</li>
</ul>
</section>
</section>
<section id="tests-before-and-after-merging-screener-data" class="level4">
<h4 class="anchored" data-anchor-id="tests-before-and-after-merging-screener-data">Tests before and after merging screener data</h4>
<ul>
<li>“record_id” and “Key” are correctly matching for both Screener 1 and Screener 2 data (i.e.&nbsp;ids and keys were not corrupted during data transformations and processing)</li>
<li>merged data correctly matches original screener data (i.e.&nbsp;merging code is valid)</li>
<li>Sum of number of prior included studies (17) and the numbers of papers included by one, or both screeners matches number of relevant entries extracted from merged data.</li>
</ul>
</section>
</section>
<section id="analyses-of-screening" class="level3">
<h3 class="anchored" data-anchor-id="analyses-of-screening">Analyses of screening</h3>
<ul>
<li>3303 entries (excluding the prior sample) were screened by either screener 1 or 2. 1480 were included by screener 1. 1662 were included by screener 2.</li>
<li>Total number of relevant entries (including 17 from the prior sample): 1949</li>
</ul>
<section id="screener-1-proportions-of-in-exclusions-notes" class="level4">
<h4 class="anchored" data-anchor-id="screener-1-proportions-of-in-exclusions-notes">Screener 1 proportions of in-/exclusions notes</h4>
<p>Screener 1 notes (%)</p>
<pre><code>  00   01   02   10   11   12   20   21   22    3 
45.6  1.9  0.9  1.5 35.7  1.7  0.4  2.6  8.1  1.8 </code></pre>
<p><img src="images/image-590281446.png" class="img-fluid"></p>
</section>
<section id="screener-2-proportions-of-in-exclusions-notes" class="level4">
<h4 class="anchored" data-anchor-id="screener-2-proportions-of-in-exclusions-notes">Screener 2 proportions of in-/exclusions notes</h4>
<p>Screener 1 notes (%)</p>
<pre><code>  00   01   02   10   11   12   20   21   22    3    4   91 
 2.6 19.5 11.9  1.1 25.1  0.5  5.4 25.1  6.8  1.9  0.1  0.0 </code></pre>
<p><img src="images/image-629835415.png" class="img-fluid"></p>
</section>
<section id="agreement-and-overlap" class="level4">
<h4 class="anchored" data-anchor-id="agreement-and-overlap">Agreement and overlap</h4>
<ul>
<li>1210 entries were included by both screeners.</li>
<li>889 entries were excluded by both screeners.</li>
<li>201 entries were included by screener 1 but excluded by screener 2.</li>
<li>371 entries were included by screener 2 but excluded by screener 1.</li>
<li>2671 entries were screened by both screeners. Of these, 1411, i.e.&nbsp;52.8 %, were included by Screener 1 and 1581, i.e.&nbsp;59.2 %, were included by Screener 2.</li>
<li>411 entries were screened exclusively by Screener 1. Of these, 69 were included, i.e.&nbsp;16.8 %.</li>
<li>221 entries were screened exclusively by Screener 2. Of these, 81 were included, i.e.&nbsp;36.7 %.</li>
</ul>
</section>
<section id="bibtex-key-creation" class="level4">
<h4 class="anchored" data-anchor-id="bibtex-key-creation">Bibtex-Key creation</h4>
<ul>
<li>There are 74 duplicate Bibtex-keys which need to be corrected when downloading the PDFs.</li>
</ul>
</section>
<section id="randomization-and-package-creation" class="level4">
<h4 class="anchored" data-anchor-id="randomization-and-package-creation">Randomization and package creation</h4>
<ul>
<li>Order of entries has been randomized</li>
<li>Data is split into 20 <code>.xslx</code> files with max of 100 entries in each file. The files are stored in <code>Nextcloud/project-vwl4makro/09_Forschung/Drittmittel/DZ2022/WP2_Meta_energy/search/CSV/Merging_labeled_and_unlabeled_dataset_for_Warm-Up_in_ASReview/After_abstract_screening/Merged_data/Packages_for_full_text_download/</code></li>
<li><code>.xslx</code> files contain only information relevant for retrieving PDFs and empty columns for notes regarding availability.</li>
</ul>
</section>
</section>
</section>
<section id="code-and-output-for-testing-merging-analyzing-and-preparing-full-text-download-of-abstract-screening-dataset" class="level2">
<h2 class="anchored" data-anchor-id="code-and-output-for-testing-merging-analyzing-and-preparing-full-text-download-of-abstract-screening-dataset">Code and output for testing, merging, analyzing and preparing full text download of abstract screening dataset</h2>
<div class="cell" data-file="merging_screener_data.R">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0      ✔ dplyr   1.0.10
✔ tibble  3.1.8      ✔ stringr 1.5.0 
✔ tidyr   1.2.1      ✔ forcats 0.5.2 
✔ purrr   0.3.5      
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/franzprante/Nextcloud/project-vwl4makro/09_Forschung/Drittmittel/DZ2022/WP2_Meta_energy/search/CSV/Merging_labeled_and_unlabeled_dataset_for_Warm-Up_in_ASReview/After_abstract_screening</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(revtools)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing screener 1 data </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>s1_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Screener_1_data/abstract-screening-morpep-energy-screener-1.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 22023 Columns: 92
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (31): Key, ItemType, Author, title, PublicationTitle, ISSN, DOI, Url, a...
dbl   (5): record_id, PublicationYear, included, labeling_order_1, Included_1
lgl  (55): ISBN, NumPages, NumberOfVolumes, SeriesNumber, SeriesText, Series...
dttm  (1): AccessDate

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing screener 2 data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>s2_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Screener_2_data/abstract-screening-morpep-energy-screener-2.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 22023 Columns: 92
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (31): Key, ItemType, Author, title, PublicationTitle, ISSN, DOI, Url, a...
dbl   (5): record_id, PublicationYear, included, labeling_order_1, Included_1
lgl  (55): ISBN, NumPages, NumberOfVolumes, SeriesNumber, SeriesText, Series...
dttm  (1): AccessDate

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Some consistency tests and corrections before merging </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Screener 1: only valid screener notes?</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(s1_data<span class="sc">$</span>exported_notes_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA   "00" "11" "02" "22" "01" "3"  "20" "21" "12" "10"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Screener 1 notes are valid."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Screener 1 notes are valid."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Screener 2: only valid screener notes?</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(s2_data<span class="sc">$</span>exported_notes_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA   "20" "02" "21" "01" "11" "3"  "00" "12" "22" "10" "4"  "91"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">'For screener 2, there is one 91, which is supposed to be 01. But this would not change the exclusion of the study.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For screener 2, there is one 91, which is supposed to be 01. But this would not change the exclusion of the study."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(s2_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(exported_notes_1<span class="sc">==</span><span class="st">"91"</span>)) <span class="co"># Inspecting the entry.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(s2_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(exported_notes_1<span class="sc">==</span><span class="st">"91"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(title, abstract)) <span class="co"># Inspecting title and abstract of the wrong entry.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimating Price Elasticities of Supply for the US Natural Gas Market"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
[2] "In order to supply internal energy needs, many countries depend on importing non-renewable energy resources such as petroleum, natural gas, and coal. Due to the high global energy dependency, it is significant to understand how the supply and demand of different fossil fuels respond to changes in price. This response is measured as elasticity and plays an important role not only for modelling supply and demand in a specific market but also in policy evaluation, planning and future trend analysis of the studied sector. The existing empirical literature in elasticities for the energy markets has concentrated mostly on the demand side. Dahl (2007) gathered more than 1.900 studies estimating elasticities of demand. On the supply side, elasticities studies have concentrated mostly on crude oil and its derivatives as well as the coal sector (see Dahl and Duggan, 1998 for a survey of elasticities of supply in the US energy sector). The limited available number of studies and the competitive structure of the North American natural gas market provides ample research potential. The United States is not only the largest consumer of natural gas, but - most relevant for the aim of our analysis - it is currently also the largest producer (BP, 2012)."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Exclusion is valid."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Exclusion is valid."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do screener 1 notes correctly correspond to in-/exlclusion of studies?</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>s1_included_notes <span class="ot">&lt;-</span> s1_data<span class="sc">$</span>exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"21"</span>, <span class="st">"22"</span>) <span class="co"># Index of entries that carry inclusion notes</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(s1_data<span class="sc">$</span>Included_1[s1_included_notes] <span class="sc">!=</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Valid! (0 implies that NO entry that carries an inclusion note is excluded)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Valid! (0 implies that NO entry that carries an inclusion note is excluded)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>s1_excluded_notes <span class="ot">&lt;-</span> s1_data<span class="sc">$</span>exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"00"</span>, <span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>) <span class="co"># Index of entries that carry exclusion notes</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(s1_data<span class="sc">$</span>Included_1[s1_excluded_notes] <span class="sc">!=</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"For screener 1, there is one entry that is included though it carries an exclusion note. But no correction necessary, as the entry will be excluded in the full text screening phase."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For screener 1, there is one entry that is included though it carries an exclusion note. But no correction necessary, as the entry will be excluded in the full text screening phase."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(s1_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Included_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"00"</span>, <span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>))) <span class="co"># Inspect the entry.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Do screener 2 notes correctly correspond to in-/exclusion of studies?</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>s2_included_notes <span class="ot">&lt;-</span> s2_data<span class="sc">$</span>exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"21"</span>, <span class="st">"22"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(s2_data<span class="sc">$</span>Included_1[s2_included_notes] <span class="sc">!=</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"For screener 2, there is one entry that was excluded though it carries an inclusion note. Correction not necessary because this mistake will only marginally affect the sample."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For screener 2, there is one entry that was excluded though it carries an inclusion note. Correction not necessary because this mistake will only marginally affect the sample."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>s2_excluded_notes <span class="ot">&lt;-</span> s2_data<span class="sc">$</span>exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"00"</span>, <span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(s2_data<span class="sc">$</span>Included_1[s2_excluded_notes] <span class="sc">!=</span> <span class="dv">0</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"There are 2 entries which were included though they carry exclusion notes. But no correction necessary, as these entries will be excluded in the full text screening phase."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are 2 entries which were included though they carry exclusion notes. But no correction necessary, as these entries will be excluded in the full text screening phase."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(s2_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Included_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> exported_notes_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"00"</span>, <span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>))) <span class="co"># Inspecting the entries.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Merging the data</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test that record id and Key are matching for both s1_data and s2_data</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(s1_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>)] <span class="sc">==</span> s2_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>)]) <span class="co"># Alternative test: sum(paste0(s1_data$record_id,s1_data$Key) != paste0(s2_data$record_id,s2_data$Key))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge s1_data and s2_data based on all variables that must have equal values, i.e. those that have not been created by ASReview</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">colnames</span>(s1_data) <span class="co"># These are the column names of the dataframe (they are equal for s1_data and s2_data, see: 'sum(colnames(s1_data) != colnames(s2_data))')</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>matching_columns <span class="ot">&lt;-</span> <span class="fu">head</span>(columns, <span class="sc">-</span><span class="dv">4</span>) <span class="co"># These are the columns that have not been created by ASReview</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(s1_data, s2_data, <span class="at">by =</span> matching_columns, <span class="at">all =</span> T, <span class="at">sort =</span> F, <span class="at">suffixes =</span> <span class="fu">c</span>(<span class="st">".s1"</span>,<span class="st">".s2"</span>)) <span class="co"># This merges the dataframes by all columns that must have equal values. Columns with separate values are retained.</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test that merged data correctly matches original data</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">na.omit</span>(merged_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>, <span class="st">"Included_1.s1"</span>, <span class="st">"exported_notes_1.s1"</span>)]) <span class="sc">==</span> <span class="fu">na.omit</span>(s1_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>, <span class="st">"Included_1"</span>, <span class="st">"exported_notes_1"</span>)])) <span class="co"># For screener 1, test that record_id, Key, Included_1 and exported_notes_1 in the merged data matches the original entries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">na.omit</span>(merged_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>, <span class="st">"Included_1.s2"</span>, <span class="st">"exported_notes_1.s2"</span>)]) <span class="sc">==</span> <span class="fu">na.omit</span>(s2_data[, <span class="fu">c</span>(<span class="st">"record_id"</span>, <span class="st">"Key"</span>, <span class="st">"Included_1"</span>, <span class="st">"exported_notes_1"</span>)])) <span class="co"># For screener 1, test that record_id, Key, Included_1 and exported_notes_1 in the merged data matches the original entries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyses of screening</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>s1_s2_agreement_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span>   </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">21803</span>) <span class="sc">%&gt;%</span> <span class="co"># Excluding the prior sample</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Key, Included_1.s1, Included_1.s2, exported_notes_1.s1, exported_notes_1.s2) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Included_1.s1) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(Included_1.s2))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(s1_s2_agreement_data), <span class="st">"entries were screened by either screener 1 or 2."</span>, <span class="fu">sum</span>(s1_s2_agreement_data<span class="sc">$</span>Included_1.s1, <span class="at">na.rm =</span> T), <span class="st">"were included by screener 1."</span>, <span class="fu">sum</span>(s1_s2_agreement_data<span class="sc">$</span>Included_1.s2, <span class="at">na.rm =</span> T), <span class="st">"were included by screener 2"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3303 entries were screened by either screener 1 or 2. 1480 were included by screener 1. 1662 were included by screener 2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Screener 1 proportions of in-/exclusions notes</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(s1_s2_agreement_data<span class="sc">$</span>exported_notes_1.s1)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  00   01   02   10   11   12   20   21   22    3 
45.6  1.9  0.9  1.5 35.7  1.7  0.4  2.6  8.1  1.8 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(s1_s2_agreement_data<span class="sc">$</span>exported_notes_1.s1)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Screener 1 notes (%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="merging_testing_pre_download_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Screener 2 proportions of in-/exclusions notes</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(s1_s2_agreement_data<span class="sc">$</span>exported_notes_1.s2)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  00   01   02   10   11   12   20   21   22    3    4   91 
 2.6 19.5 11.9  1.1 25.1  0.5  5.4 25.1  6.8  1.9  0.1  0.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(s1_s2_agreement_data<span class="sc">$</span>exported_notes_1.s2)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Screener 2 notes (%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="merging_testing_pre_download_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agreement and overlap</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Included by both screeners</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>included_both <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Included_1.s1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Included_1.s2 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(included_both), <span class="st">"entries were included by both screeners."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1210 entries were included by both screeners."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluded by both screeners </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>excluded_both <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Included_1.s1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Included_1.s2 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(excluded_both), <span class="st">"entries were excluded by both screeners."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "889 entries were excluded by both screeners."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Included by screener 1, excluded by screener 2</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>included_s1_excluded_s2 <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Included_1.s1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Included_1.s2 <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(included_s1_excluded_s2), <span class="st">"entries were included by screener 1 but excluded by screener 2."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "201 entries were included by screener 1 but excluded by screener 2."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Included by Screener 2, excluded by screener 1</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>included_s2_excluded_s1 <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Included_1.s1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Included_1.s2 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(included_s2_excluded_s1), <span class="st">"entries were included by screener 2 but excluded by screener 1."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "371 entries were included by screener 2 but excluded by screener 1."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Screened by both screener 1 and 2</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>both <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Included_1.s2) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Included_1.s1))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(both), <span class="st">"entries were screened by both screeners. Of these,"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(both<span class="sc">$</span>Included_1.s1), <span class="st">", i.e."</span>, <span class="fu">round</span>(<span class="fu">sum</span>(both<span class="sc">$</span>Included_1.s1)<span class="sc">/</span><span class="fu">nrow</span>(both)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%, were included by Screener 1 and"</span>, <span class="fu">sum</span>(both<span class="sc">$</span>Included_1.s2), <span class="st">", i.e."</span>, <span class="fu">round</span>(<span class="fu">sum</span>(both<span class="sc">$</span>Included_1.s2)<span class="sc">/</span><span class="fu">nrow</span>(both)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%, were included by Screener 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2671 entries were screened by both screeners. Of these, 1411 , i.e. 52.8 %, were included by Screener 1 and 1581 , i.e. 59.2 %, were included by Screener 2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclusively screened by Screener 1</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>only_s1 <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Included_1.s2) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Included_1.s1))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(only_s1), <span class="st">"entries were screened exclusively by Screener 1. Of these,"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(only_s1<span class="sc">$</span>Included_1.s1), <span class="st">"were included, i.e."</span>, <span class="fu">round</span>(<span class="fu">sum</span>(only_s1<span class="sc">$</span>Included_1.s1)<span class="sc">/</span><span class="fu">nrow</span>(only_s1)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "411 entries were screened exclusively by Screener 1. Of these, 69 were included, i.e. 16.8 %"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclusively screened by Screener 2</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>only_s2 <span class="ot">&lt;-</span> s1_s2_agreement_data <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Included_1.s1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Included_1.s2))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(only_s2), <span class="st">"entries were screened exclusively by Screener 2. Of these,"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(only_s2<span class="sc">$</span>Included_1.s2), <span class="st">"were included, i.e."</span>, <span class="fu">round</span>(<span class="fu">sum</span>(only_s2<span class="sc">$</span>Included_1.s2)<span class="sc">/</span><span class="fu">nrow</span>(only_s2)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "221 entries were screened exclusively by Screener 2. Of these, 81 were included, i.e. 36.7 %"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting relevant studies</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>relevant_entries <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Included_1.s1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> Included_1.s2 <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that number of included in merged relevant entries matches number of included in original screener data</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(relevant_entries<span class="sc">$</span>Included_1.s1, <span class="at">na.rm =</span> T) <span class="sc">==</span> <span class="fu">sum</span>(s1_data<span class="sc">$</span>Included_1, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(relevant_entries<span class="sc">$</span>Included_1.s2, <span class="at">na.rm =</span> T) <span class="sc">==</span> <span class="fu">sum</span>(s2_data<span class="sc">$</span>Included_1, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that sum of number of prior included studies (17) and the numbers of papers inlcluded by one, or both screeners matches length of relevant_entries</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>number_of_prior_included <span class="ot">&lt;-</span> <span class="fu">nrow</span>(merged_data <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">220</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(included.s1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> included.s2 <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(relevant_entries) <span class="sc">==</span> <span class="fu">sum</span>(<span class="fu">nrow</span>(included_both) <span class="sc">+</span> <span class="fu">nrow</span>(included_s1_excluded_s2) <span class="sc">+</span> <span class="fu">nrow</span>(included_s2_excluded_s1) <span class="sc">+</span> <span class="fu">sum</span>(only_s1<span class="sc">$</span>Included_1.s1) <span class="sc">+</span> <span class="fu">sum</span>(only_s2<span class="sc">$</span>Included_1.s2) <span class="sc">+</span> number_of_prior_included)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of relevant entries, including those from prior sample</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(relevant_entries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1949</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a bibtex key</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Creates a Bibtex key from a dataframe with publication information.</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function takes three inputs, year, author and</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' title, and creates a Bibtex key for each row in the dataframe. The Bibtex key has</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' the format: name-of-first-author_year_first-word-of-title.</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param year A vector with the publication years.</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param author A vector with the authors' names.</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param title A vector with the publication titles.</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A vector with the Bibtex keys.</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>create_bibtex_key <span class="ot">&lt;-</span> <span class="cf">function</span>(year, author, title) {</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split author names and select first name</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  first_author <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(author, <span class="st">","</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove non-alphanumeric characters from first word of title and convert to lowercase</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  first_word <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"[^[:alnum:]]"</span>, <span class="st">""</span>, <span class="fu">strsplit</span>(title, <span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]))</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine components to create Bibtex key</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(first_author, <span class="st">"_"</span>, year, <span class="st">"_"</span>, first_word)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>relevant_entries<span class="sc">$</span>BibtexKey <span class="ot">&lt;-</span> <span class="fu">apply</span>(relevant_entries, <span class="dv">1</span>, <span class="cf">function</span>(row) {</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_bibtex_key</span>(row[<span class="st">"PublicationYear"</span>], row[<span class="st">"Author"</span>], row[<span class="st">"title"</span>])</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Test uniqueness of bibtex keys:</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(relevant_entries<span class="sc">$</span>BibtexKey)) <span class="sc">==</span> <span class="fu">length</span>(relevant_entries<span class="sc">$</span>BibtexKey)) {</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"The generated Bibtex-keys are unique."</span>)</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"There are "</span>, <span class="fu">length</span>(relevant_entries<span class="sc">$</span>BibtexKey) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">unique</span>(relevant_entries<span class="sc">$</span>BibtexKey)), <span class="st">" duplicate Bibtex-keys."</span>)</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#View(as.data.frame(relevant_entries$BibtexKey[duplicated(relevant_entries$BibtexKey)]))</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There are 74 duplicate Bibtex-keys.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomizing the order of the dataset</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the random seed</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">364</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomizing the dataframe</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>randomized_relevant_entries <span class="ot">&lt;-</span> relevant_entries[<span class="fu">sample</span>(<span class="fu">nrow</span>(relevant_entries)),]</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract data for full text download</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>data_for_download <span class="ot">&lt;-</span> randomized_relevant_entries <span class="sc">%&gt;%</span> </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(record_id, Key, Author, title, PublicationYear, PublicationTitle, Issue, Volume, ItemType, abstract, DOI, Url, BibtexKey) <span class="sc">%&gt;%</span> </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">most_recent_version_available =</span> <span class="cn">NA</span>, <span class="at">not_available =</span> <span class="cn">NA</span>, <span class="at">retracted =</span> <span class="cn">NA</span>, <span class="at">duplicate =</span> <span class="cn">NA</span>, <span class="at">notes_PDF_download =</span> <span class="cn">NA</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create packages for full text download</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' Save Dataframe to Multiple Excel Files</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' This function saves the entries of a dataframe into xlsx files with a maximum of 100 entries per file.</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df The dataframe to be saved.</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file_path The path and filename prefix for the output files.</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return None</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>save_to_xlsx <span class="ot">&lt;-</span> <span class="cf">function</span>(df, file_path) {</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get number of files to be saved</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  n_files <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(df) <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split dataframe into chunks of 100 rows</span></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  df_list <span class="ot">&lt;-</span> <span class="fu">split</span>(df, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_files, <span class="at">each=</span><span class="dv">100</span>, <span class="at">length.out=</span><span class="fu">nrow</span>(df)))</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save each chunk to a separate file</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df_list)) {</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(file_path, <span class="st">"_"</span>, i, <span class="st">".xlsx"</span>)</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.xlsx</span>(df_list[[i]], file_name, <span class="at">rowNames =</span> <span class="cn">FALSE</span>)</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a><span class="co"># save_to_xlsx(data_for_download, "Nextcloud/project-vwl4makro/09_Forschung/Drittmittel/DZ2022/WP2_Meta_energy/search/CSV/Merging_labeled_and_unlabeled_dataset_for_Warm-Up_in_ASReview/After_abstract_screening/Merged_data/Packages_for_full_text_download/study_set")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>